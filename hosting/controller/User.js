sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox","sap/m/MessageToast"],function(i,t,e){"use strict";return i.extend("com.digiArtitus.controller.User",{constructor:function(i){this._oInstance=i;this._oView=i.getView();this.oViewModel=this._oView.getModel("oViewModel");this._loadLoginHtml()},_loadLoginHtml:function(){var i="<!DOCTYPE html>"+'<div class="login-page">'+'<div class="page">'+'<div class="container">'+'<div class="left">'+'<div class="login">Login</div>'+'<div class="eula"><strong>DIGI ADMIN</strong> Tool, A Complete data management and billing system</div>'+'<div class="hbox hbox-left-box-margin">'+'<input type="submit" id="admin-btn-id" value="ADMIN" class="btn-select btn-select-left-box">'+'<input type="submit" id="manager-btn-id" value="MANAGER" class="btn-select btn-selected btn-select-left-box">'+"</div>"+"</div>"+'<div class="right">'+'<div class="form">'+'<label for="email">Phone or Email</label>'+'<input type="email" id="email" class="input-border input-border-active">'+'<label for="password">Password</label>'+'<input type="password" id="password" class="input-border">'+'<div class="hbox hbox-right-box-margin">'+'<input type="submit" id="reset" value="Reset" class="btn-select btn-select-right-box">'+'<input type="submit" id="submit" value="Submit" class="btn-select btn-selected btn-select-right-box">'+"</div>"+'<div class="forget-password">'+"Forgot Password"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";jQuery.sap.delayedCall(250,this,function(){this._loadEventListners()});return new sap.ui.core.HTML({preferDOM:true,content:i})},checkForLogin:function(){return new Promise(function(i,t){firebase.auth().onAuthStateChanged(function(e){com.digiArtitus.StartGlobalBusyIndicator();var s=this._oView.byId("app");var a=s.getPages();var n=a.length;if(n!==0){for(var o=0;o<n;o++){a[o].destroy()}}var r=false;var d;if(e){com.digiArtitus.userId=e.uid;d=sap.ui.xmlfragment(this._oView.getId(),"com.digiArtitus.fragment.main",this._oInstance)}else{r=!r;d=this._loadLoginHtml()}s.addPage(new sap.m.Page({showHeader:false,content:d}));if(com.digiArtitus.LoggedIn){this._oInstance._loadPageControls();return}else if(com.digiArtitus.LoggedOff){com.digiArtitus.EndGlobalBusyIndicator();return}if(!com.digiArtitus.LoggedIn||!com.digiArtitus.LoggedOff){com.digiArtitus.EndGlobalBusyIndicator()}if(r){t()}else{i()}}.bind(this))}.bind(this))},loadUserData:function(){return new Promise(function(i,t){var e=function(t){var e=t.data();com.digiArtitus.userName=e.USER_NAME;com.digiArtitus.userPic=e.USER_PIC;com.digiArtitus.role=e.USER_ROLE;com.digiArtitus.companyCode=e.USER_COMPANY_CODE;com.digiArtitus.billingCity=e.BILLING_CITY;com.digiArtitus.billingCountry=e.BILLING_COUNTRY;com.digiArtitus.billingStreet=e.BILLING_STREET;com.digiArtitus.billingStreetNo=e.BILLING_STREET_NO;com.digiArtitus.billingZipcode=e.BILLING_ZIPCODE;com.digiArtitus.billingDeliveryCharge=e.BILLING_DELIVERY_CHARGE;com.digiArtitus.billingDeliveryCheck=e.BILLING_DELIVERY_CHECK;this.oViewModel.setProperty("/COMPANY_NAME",e.USER_NAME);this.oViewModel.setProperty("/COMPANY_PIC",e.USER_PIC);i()}.bind(this);firebase.firestore().collection("users").doc(com.digiArtitus.userId).get().then(e)}.bind(this))},_loadEventListners:function(){$.sap.delayedCall(200,this,function(){$("#admin-btn-id").click(function(){$("#admin-btn-id").addClass("btn-selected");$("#manager-btn-id").removeClass("btn-selected");this.ADMIN_LOGIN=!this.ADMIN_LOGIN}.bind(this));$("#manager-btn-id").click(function(){$("#manager-btn-id").addClass("btn-selected");$("#admin-btn-id").removeClass("btn-selected");this.ADMIN_LOGIN=!this.ADMIN_LOGIN}.bind(this));$("#email").click(function(){$("#email").addClass("input-border-active");$("#password").removeClass("input-border-active")}.bind(this));$("#email").focus();$("#password").click(function(){$("#password").addClass("input-border-active");$("#email").removeClass("input-border-active")}.bind(this));$("#reset").click(function(){$("#email").val("");$("#password").val("");$("#email").click();$("#email").focus()}.bind(this));$("#submit").click(function(){this.USER_NAME=$("#email").val().trim();if(this.USER_NAME===""||this.USER_NAME===null){e.show("Enter valid phone number or email id");return}this.PASSWORD=$("#password").val().trim();if(this.PASSWORD===""||this.PASSWORD===null){e.show("Enter valid password");return}com.digiArtitus.StartGlobalBusyIndicator();var i=this;firebase.auth().signInWithEmailAndPassword(this.USER_NAME,this.PASSWORD).then(function(){com.digiArtitus.LoggedIn=true}).catch(function(e){var s=e.message;var a=!!i.getView().$().closest(".sapUiSizeCompact").length;t.error(s,{styleClass:a?"sapUiSizeCompact":""})})}.bind(this));$(".forget-password").click(function(){e.show("Forget password")})})}})});