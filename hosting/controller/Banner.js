sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,i){"use strict";return e.extend("com.digiArtitus.controller.Banner",{constructor:function(e){this._oInstance=e;this._oView=e.getView();this.oViewModel=this._oView.getModel("oViewModel")},liveBannerCollectionUpdates:function(){var e=function(e){var t=this.oViewModel.getData();var i=[];e.forEach(function(e){i.push({DOC_REF:e.ref,USER_ID:e.data().USER_ID,NAME:e.data().NAME,INITIALS:e.data().NAME.substr(0,1),TIME_STAMP:moment(e.data().TIME_STAMP).format("Do MMM YYYY")})});t.BANNER_COLLECTION=i;this.oViewModel.refresh()}.bind(this);firebase.firestore().collection("DATABASE").doc(com.digiArtitus.companyCode).collection("BANNER_COLLECTION").onSnapshot(e)},liveBannerItemsUpdates:function(){var e=function(e){var t=this.oViewModel.getData();var i=[];e.forEach(function(e){i.push({DOC_REF:e.ref,USER_ID:e.data().USER_ID,NAME:e.data().NAME,INITIALS:e.data().NAME.substr(0,1),TIME_STAMP:moment(e.data().TIME_STAMP).format("Do MMM YYYY"),BANNER_COLLECTION:e.data().BANNER_COLLECTION,IMAGE_NAME:e.data().IMAGE_NAME,IMAGE_URL:e.data().IMAGE_URL,IMAGE_REF_PATH:e.data().IMAGE_REF_PATH})});t.BANNER_ITEMS=i;this.oViewModel.refresh()}.bind(this);firebase.firestore().collection("DATABASE").doc(com.digiArtitus.companyCode).collection("BANNER_ITEMS").onSnapshot(e)},onBannerCollectionSave:function(){var e=this.oViewModel.getData();var t=this._oView;var o=[t.byId("banner-collection-name-id")];var n=false;jQuery.each(o,function(e,t){n=this._validateInput(t)||n}.bind(this._oInstance));if(n){i.show("A validation error has occurred. Complete your input first");return}com.digiArtitus.StartGlobalBusyIndicator();var a={NAME:e.BANNER_COLLECTION_NAME,TIME_STAMP:firebase.firestore.Timestamp.fromDate(new Date)};if(this.BANNER_COLLECTION_EDIT_FLAG){this.BANNER_COLLECTION_EDIT_DATA.DOC_REF.update(a).then(function(){this._bannerCollectionDialog().close();this.BANNER_COLLECTION_EDIT_FLAG=false;e.BANNER_COLLECTION_NAME="";this.oViewModel.refresh();com.digiArtitus.EndGlobalBusyIndicator()}.bind(this)).catch(function(e){i.show("Error in posting data");com.digiArtitus.EndGlobalBusyIndicator()})}else{a.USER_ID=com.digiArtitus.userId;com.digiArtitus.FirestoreInstance().collection("DATABASE").doc(com.digiArtitus.companyCode).collection("BANNER_COLLECTION").add(a).then(function(){e.BANNER_COLLECTION_NAME="";this.oViewModel.refresh();this._bannerCollectionDialog().close();com.digiArtitus.EndGlobalBusyIndicator()}.bind(this)).catch(function(e){i.show("Error in posting data")})}},onBannerItemSave:function(){var e=this.oViewModel.getData(),t=this._oView,o=[t.byId("banner-item-name-id")],n=false,a,E=firebase.storage().ref();jQuery.each(o,function(e,t){n=this._validateInput(t)||n}.bind(this._oInstance));if(e.ANNER_ITEM_PREVIEW_UPLOADER_FILE===""){i.show("Add an image to create record!");return}if(n){i.show("A validation error has occurred. Complete your input first");return}com.digiArtitus.StartGlobalBusyIndicator();var r=function(){this._bannerItemDialog().close();this.onBannerItemRemoveImagePress();e.BANNER_ITEM_UPLOADER_EDIT_CHANGE_FLAG=false;e.BANNER_ITEM_NAME="";this.oViewModel.refresh();com.digiArtitus.EndGlobalBusyIndicator()}.bind(this);if(e.BANNER_ITEM_UPLOADER_EDIT_FLAG){a={TIME_STAMP:firebase.firestore.Timestamp.fromDate(new Date),NAME:e.BANNER_ITEM_NAME};if(e.BANNER_ITEM_UPLOADER_EDIT_CHANGE_FLAG){var _=E.child(this.BANNER_ITEM_EDIT_DATA.IMAGE_REF_PATH);_.delete().then(()=>{var t=e.BANNER_ITEM_UPLOADER_FILE;a.IMAGE_NAME=t.name;a.IMAGE_REF_PATH=com.digiArtitus.companyCode+"/BANNER/"+(new Date).getTime()+"_"+t.name;var i=E.child(a.IMAGE_REF_PATH);i.put(t).then(e=>{e.ref.getDownloadURL().then(e=>{a.IMAGE_URL=e;this.BANNER_ITEM_EDIT_DATA.DOC_REF.update(a).then(r)})})})}else{this.BANNER_ITEM_EDIT_DATA.DOC_REF.update(a).then(function(){r()}).catch(function(e){i.show("Error in posting data");com.digiArtitus.EndGlobalBusyIndicator()})}}else{var s=e.BANNER_ITEM_UPLOADER_FILE;a={USER_ID:com.digiArtitus.userId,USER_COMPANY_CODE:com.digiArtitus.companyCode,IMAGE_NAME:s.name,TIME_STAMP:firebase.firestore.Timestamp.fromDate(new Date),BANNER_COLLECTION:e.SELECTED_BANNER_COLL_NAME,NAME:e.BANNER_ITEM_NAME};a.IMAGE_REF_PATH=com.digiArtitus.companyCode+"/BANNER/"+(new Date).getTime()+"_"+s.name;var A=E.child(a.IMAGE_REF_PATH);A.put(s).then(e=>{e.ref.getDownloadURL().then(e=>{a.IMAGE_URL=e;com.digiArtitus.FirestoreInstance().collection("DATABASE").doc(com.digiArtitus.companyCode).collection("BANNER_ITEMS").add(a).then(r).catch(function(e){i.show("Error in posting data");com.digiArtitus.EndGlobalBusyIndicator()})})})}},_bannerItemDialog:function(){if(!this.bannerItemDialog){var e=this._oView;this.bannerItemDialog=sap.ui.xmlfragment(e.getId(),"com.digiArtitus.fragment.banner-item",this);e.addDependent(this.bannerItemDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",e,this.bannerItemDialog)}return this.bannerItemDialog},_bannerCollectionDialog:function(){if(!this.bannerCollectionDialog){var e=this._oView;this.bannerCollectionDialog=sap.ui.xmlfragment(e.getId(),"com.digiArtitus.fragment.banner-collection",this);e.addDependent(this.bannerCollectionDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",e,this.bannerCollectionDialog)}return this.bannerCollectionDialog},onBannerCollectionDialogClose:function(){this._bannerCollectionDialog().close()},bannerCollectionEdit:function(e){var t=e.getSource(),i=t.getBindingContext("oViewModel").getObject(),o=this.oViewModel.getData();this.BANNER_COLLECTION_EDIT_FLAG=true;this.BANNER_COLLECTION_EDIT_DATA=i;o.BANNER_COLLECTION_NAME=i.NAME;this._bannerCollectionDialog().open();this.oViewModel.refresh()},bannerItemEdit:function(e){var t=e.getSource(),i=t.getBindingContext("oViewModel").getObject(),o=this.oViewModel.getData();this.BANNER_ITEM_EDIT_DATA=i;o.BANNER_ITEM_UPLOADER_EDIT_FLAG=true;o.BANNER_ITEM_UPLOADER_EDIT_CHANGE_FLAG=false;o.BANNER_ITEM_NAME=i.NAME;o.BANNER_ITEM_PREVIEW_VISIBLE=true;o.BANNER_ITEM_PREVIEW_UPLOADER_FILE=i.IMAGE_URL;this._bannerItemDialog().open();this.oViewModel.refresh()},onBannerItemLoadImagePress:function(){this._oInstance._fileUploaderLoad("banner-item-file-uploader-id","BANNER_ITEM_UPLOADER_FILE","BANNER_ITEM_UPLOADER_EDIT_FLAG","BANNER_ITEM_UPLOADER_EDIT_CHANGE_FLAG","BANNER_ITEM_PREVIEW_UPLOADER_FILE","BANNER_ITEM_PREVIEW_VISIBLE")},onBannerItemRemoveImagePress:function(){this._oInstance._fileUploaderUnLoad("banner-item-file-uploader-id","BANNER_ITEM_UPLOADER_FILE","BANNER_ITEM_UPLOADER_EDIT_CHANGE_FLAG","BANNER_ITEM_PREVIEW_UPLOADER_FILE","BANNER_ITEM_PREVIEW_VISIBLE")},onBannerItemDialogClose:function(){this._bannerItemDialog().close()}})});