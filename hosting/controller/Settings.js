sap.ui.define(["sap/ui/base/Object","sap/m/MessageBox","sap/m/MessageToast"],function(t,e,i){"use strict";return t.extend("com.digiArtitus.controller.Settings",{_formFragments:{},constructor:function(t){this._oInstance=t;this._oView=t.getView();this.oViewModel=this._oView.getModel("oViewModel")},_loadFormValues:function(t){var e=function(t){this._oView.setModel(new sap.ui.model.json.JSONModel(t),"oSettingsModel")};var s=function(){i.show("Unable to load user settings, please try again later.")};this._getUserSettingInfo().then($.proxy(e,this)).catch(s)},_showFormFragment:function(t){var e=this._oView.byId("settings-page-content");e.removeAllItems();e.insertItem(this._getFormFragment(t))},_getFormFragment:function(t){var e=this._formFragments[t];if(e){return e}e=sap.ui.xmlfragment(this._oView.getId(),"com.digiArtitus.fragment."+t);this._formFragments[t]=e;return this._formFragments[t]},_settingsPageDefaults:function(){this._showFormFragment("settings-display");this._loadFormValues()},_getUserSettingInfo:function(){return new Promise((t,e)=>{var i=function(e){var i=e.data();var s={GST_NO:i.GST_NO,USER_NAME:i.USER_NAME,BILLING_STREET_NO:i.BILLING_STREET_NO,BILLING_STREET:i.BILLING_STREET,BILLING_ZIPCODE:i.BILLING_ZIPCODE,BILLING_CITY:i.BILLING_CITY,BILLING_COUNTRY:i.BILLING_COUNTRY,USER_PIC:i.USER_PIC,USER_ROLE:i.USER_ROLE,USER_COMPANY_CODE:i.USER_COMPANY_CODE,WEB_SITE:i.WEB_SITE,FACEBOOK:i.FACEBOOK,YOUTUBE:i.YOUTUBE,INSTAGRAM:i.INSTAGRAM,BILLING_DELIVERY_CHARGE:i.BILLING_DELIVERY_CHARGE,BILLING_DELIVERY_CHECK:i.BILLING_DELIVERY_CHECK,SMS_NOTIFICATION:i.SMS_NOTIFICATION,EMAIL:i.EMAIL,TEL:i.TEL,SMS:i.SMS};com.digiArtitus.EndGlobalBusyIndicator();t(s)};var s=function(){com.digiArtitus.EndGlobalBusyIndicator();e()};com.digiArtitus.StartGlobalBusyIndicator();com.digiArtitus.FirestoreInstance().collection("users").doc(com.digiArtitus.userId).get().then(i).catch(s)})},_updateFormValues:function(){return Promise.all([this._getUserSettingInfo()]).then(function(t){var e=t[0];var s=this._oView.getModel("oSettingsModel").getData();if(JSON.stringify(e)===JSON.stringify(s)){i.show("No changes found to save");return}return new Promise((t,e)=>{com.digiArtitus.StartGlobalBusyIndicator();var n=function(){com.digiArtitus.EndGlobalBusyIndicator();t()};var o=function(){i.show("Unable to save changes, please try again later.");com.digiArtitus.EndGlobalBusyIndicator();e()};com.digiArtitus.FirestoreInstance().collection("users").doc(com.digiArtitus.userId).set(s).then(n).catch(o)})}.bind(this))},handleSettingsEditPress:function(){this._toggleButtonsAndView(true)},handleSettingsSavePress:function(){var t=function(){this._toggleButtonsAndView(false)}.bind(this);this._updateFormValues().then(t)},handleSettingsCancelPress:function(){this._toggleButtonsAndView(false)},_toggleButtonsAndView:function(t){var e=this._oView;e.byId("settings-edit-id").setVisible(!t);e.byId("settings-save-id").setVisible(t);e.byId("settings-cancel-id").setVisible(t);this._showFormFragment(t?"settings-change":"settings-display")}})});